@page

@model BookListRazor.Pages.Category.ListModel

<br />
<div class="container p-0 m-0">
    <div class="col-10">
        <h2 class="text-info">Category List</h2>
    </div>
    <div class="col-3">
        <a asp-page="Create" class="btn btn-info form-control text-white">Create New Category</a>
    </div>

    <div class="col-14 border p-3">
        <table id="DT_load" class="table table-striped table-bordered" style="width:100%;">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>IsActive</th>
                    <th>CreatedOn</th>
                    <th>LastUpdatedOn</th>
                    <th>Products</th>
                    <th>Action</th>
                </tr>
            </thead>
        </table>
    </div>
</div>


@section Scripts {
    <script type="text/javascript">
        // Global variables...
        var dataTable;

        $(document).ready(function () {
            dataTable = $("#DT_load").dataTable
                ({
                    "ajax": {
                        "url": "https://localhost:5001/api/Category/GetAll",
                        "type": "GET",
                        "datatype": "json",
                        "dataSrc": "result"
                    },
                    "columns": [
                        { "data": "name" },
                        { "data": "description" },
                        { "data": "isActive" },
                        {
                            "data": "createdOn",
                            "render": function (value) {
                                if (value === null) return "";
                                return moment(value).format('MMMM Do YYYY, h:mm:ss a');
                            }
                        },
                        {
                            "data": "lastUpdatedOn",
                            "render": function (value) {
                                if (value === null) return "";
                                return moment(value).format('MMMM Do YYYY, h:mm:ss a');
                            }
                        },
                        { "data": "products" },
                        {

                            "data": "id",

                            "render": function (id) {
                                return `<div class="text-center">
                                                                   <a href="/Category/Edit?id=${id}" class='btn btn-success button id= 'editbtn' text-white btn-custom'> Edit </a>&nbsp;
                                                                   <a class='btn btn-danger text-white btn-custom' onclick=DeleteCategory(${id})> Delete </a>
                                                                   </div>`;
                            }
                        },
                    ],
                    "language":
                    {
                        "emptyTable": "no data found"
                    },
                });
        });

         function DeleteCategory(id) {
            swal({
                title: "Are you sure?",
                text: "Once deleted,you will not be able to recover.",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            }).then((willDelete) => {
                if (willDelete) {
                    $.ajax({
                        type: "DELETE",
                        url: 'https://localhost:5001/api/Category/Delete?id=' + id,
                        success: function (data) {
                            if (data.result) {
                                toastr.success(data.message);
                                dataTable.ajax.reload();
                            }
                            else {
                                toastr.error(data.message);
                            }
                        }

                    });
                }

            });
        };
    </script>
}